# Practice Routines — Design

## Overview

Add a practice planning feature to BenchAssist. Coaches browse a curated drill library, filter by category, and get auto-generated practice plans. Fully offline — static drill data ships with the app.

## Data Model

### Birth Year on Team

Teams store `birthYear: number | null` as the source of truth. The U-age (e.g., U9) and drill age bracket (e.g., U10) are derived at runtime. This approach:

- Never goes stale (birth year 2017 is always 2017; "U9" becomes "U10" next year)
- Works naturally for birth-year leagues (GYSA) and U-age leagues alike
- Supports future sports beyond soccer

```typescript
// Added to Team interface:
birthYear: number | null;
```

### Age Derivation Utilities (`src/utils/age.ts`)

```typescript
export type DrillAgeGroup = 'U6' | 'U8' | 'U10' | 'U12' | 'U14' | 'U16' | 'U18';

export function getUAge(birthYear: number): number; // e.g., 2017 → 9 (in 2026)
export function getDrillBracket(birthYear: number): DrillAgeGroup; // e.g., 2017 → 'U10'
export function birthYearToDisplay(birthYear: number): string; // e.g., "2017 (U9)"
export function uAgeToBirthYear(uAge: number): number; // e.g., 9 → 2017
```

The `DrillAgeGroup` brackets are broad developmental stages used for drill tagging. A U9 team (birthYear 2017) maps to the U10 drill bracket.

### Drill Types (`src/types/drill.ts`)

```typescript
export type DrillId = string;

export type DrillCategory =
  // Technical (all ages, emphasis for younger)
  | 'passing'
  | 'dribbling'
  | 'shooting'
  | 'first-touch'
  | 'goalkeeping'
  // Tactical (U12+)
  | 'attacking'
  | 'defending'
  | 'possession'
  | 'transition'
  | 'set-pieces';

export type DrillPhase = 'warm-up' | 'main' | 'scrimmage' | 'cool-down';

export interface Drill {
  id: DrillId;
  name: string;
  description: string; // 2-3 sentence summary (always visible)
  setup: string; // How to set up the drill (expanded view)
  coachingTips: string[]; // Key things to watch for
  variations?: string[]; // Progressions / modifications
  category: DrillCategory;
  phase: DrillPhase;
  ageGroups: DrillAgeGroup[];
  minPlayers: number;
  durationMinutes: number;
  intensity: 'low' | 'medium' | 'high';
  equipment: string[]; // e.g., ['cones', 'pinnies']
}

export interface DrillProgression {
  id: string;
  name: string; // e.g., "Passing: Short to Long Range"
  drillIds: DrillId[]; // ordered sequence
}

export interface TrainingFocusTemplate {
  id: string;
  name: string;
  description: string;
  ageGroups: DrillAgeGroup[];
  slots: {
    phase: DrillPhase;
    preferredCategories: DrillCategory[];
    count: number;
  }[];
}
```

### Favorites

Stored as `favoriteDrillIds: DrillId[]` in AppState (top-level, not per-team). Included in export/import. One new reducer action: `TOGGLE_FAVORITE_DRILL`.

```typescript
export interface AppState {
  teams: Record<TeamId, Team>;
  games: Record<GameId, Game>;
  favoriteDrillIds: DrillId[];
}
```

### Static Data Files

- `src/data/drills.ts` — Array of ~60-80 curated Drill objects
- `src/data/drill-progressions.ts` — DrillProgression[] linking related drills
- `src/data/training-focuses.ts` — TrainingFocusTemplate[] defining practice day structures

Drills are researched best-practice exercises appropriate for each age bracket. Content generated by agents using web research.

## UX Flow

### Navigation

- Top nav: Add "Practice" between "Teams" and "History"
- Team management page: Add "Practice" shortcut → navigates to `/practice?team={teamId}`

### Route

```
/practice                  — Practice planning page
/practice?team={teamId}    — Same, pre-filtered to team's birth year + player count
```

### Page Layout — Unified Browse + Generate

Single page with reactive plan generation. No separate modes or submit buttons.

**Top section (inputs):**

- Birth year input (number, with "= U{age}" helper text) + quick-select U-age chips
- Player count input (pre-filled from team roster if applicable)
- Category filter chips (multi-select, toggleable). Tactical categories hidden for U6-U10 brackets.
- Duration dropdown (30/45/60/75/90 min)
- "Favorites only" toggle

**Bottom section (reactive output):**

When **no categories selected**: browsable drill list grouped by phase. All drills matching age bracket + player count shown. Each card shows name, category badge, duration, player count, summary, and coaching tip.

When **≥1 category selected**: auto-generated practice plan. Updates live as inputs change. Structure:

1. Warm-up (1 drill, low intensity, from selected or general categories)
2. Main drills (2-3 drills from selected categories, prefer drills from same progression)
3. Scrimmage (1 drill, if enough players)
4. Cool-down (1 drill, low intensity)

Plan targets the selected duration by adjusting drill count and selecting appropriate duration drills.

**Drill cards (always visible):**

- Name + favorite star toggle
- Metadata: category badge, duration, min players
- 2-3 sentence description
- Coaching tip
- "More" expand: setup instructions, variations, equipment

**Plan controls:**

- `[↻]` swap button per drill — replaces with another matching drill
- "Shuffle All" — regenerates entire plan with same constraints
- "Favorites only" — constrains generator to favorited drills only

### Plan Generator Algorithm

Simple, seeded PRNG, runs client-side (no worker needed):

1. Filter drill library by: age bracket, player count (≥ minPlayers), selected categories
2. For each slot in the plan structure:
   a. Filter to matching phase + preferred categories
   b. Pick from candidates using seeded shuffle (deterministic per seed)
3. Fill main drills to match target duration budget
4. If not enough drills for a slot, widen category filter or skip

## State Changes

### AppState additions

- `favoriteDrillIds: string[]` at top level
- `birthYear: number | null` on Team

### New reducer actions

- `TOGGLE_FAVORITE_DRILL` — `{ type: 'TOGGLE_FAVORITE_DRILL'; payload: string }`
- `SET_TEAM_BIRTH_YEAR` — `{ type: 'SET_TEAM_BIRTH_YEAR'; payload: { teamId: TeamId; birthYear: number | null } }`

### Migration (v2→v3)

- Add `birthYear: null` to all existing teams
- `loadData()` handles missing `favoriteDrillIds` (default `[]`)

## Files to Create/Modify

### New files

- `src/utils/age.ts` — DrillAgeGroup type, getUAge, getDrillBracket, etc.
- `src/utils/age.test.ts` — Age utility tests
- `src/types/drill.ts` — Drill, DrillProgression, TrainingFocusTemplate types
- `src/data/drills.ts` — Static drill library
- `src/data/drill-progressions.ts` — Progression definitions
- `src/data/training-focuses.ts` — Training focus templates
- `src/utils/practiceGenerator.ts` — Plan generation algorithm
- `src/utils/practiceGenerator.test.ts` — Generator tests
- `src/pages/Practice.tsx` — Practice planning page
- `src/pages/Practice.test.tsx` — Page component tests

### Modified files

- `src/types/domain.ts` — Add birthYear to Team
- `src/test/factories.ts` — Add birthYear to teamFactory
- `src/context/AppContext.tsx` — Add favoriteDrillIds to state, new reducer actions
- `src/storage/localStorage.ts` — v2→v3 migration, favoriteDrillIds in StorageData
- `src/storage/localStorage.test.ts` — Migration tests
- `src/App.tsx` — Add /practice route
- `src/components/layout/AppShell.tsx` — Add Practice nav link
- `src/pages/TeamManagement.tsx` — Add birth year input + Practice shortcut
- `src/pages/Dashboard.tsx` — Show U-age on team cards

## Non-goals (V1)

- Persistent saved plans (plans are ephemeral, regenerate as needed)
- Drill diagrams/animations (text descriptions only for V1)
- Custom user-created drills (static library only)
- Multi-sport support (soccer only, architecture supports future sports)
